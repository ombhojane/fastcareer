<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Career Re-Entry Readiness Test</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
<link rel="stylesheet" href="/static/css/style.css">
<style>

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.bg-mustard {
    background-color: #ffdb58; /* Mustard color */
}

.question-container {
    animation: fadeIn 0.5s ease-out;
}

.question-container {
    padding-right: 1rem; /* Add padding to ensure text does not touch the container edges */
    padding-left: 1rem;
}

 /* Increase spacing around questions for better visual separation */
 .question label, .radio-container h3, .rating-label {
    font-size: 1rem; /* Adjust font size if needed */
    margin-top: 0.5rem; /* Adjust top margin to avoid negative values that may cause overlap */
    margin-bottom: 1rem; /* Adjust bottom margin for consistency */
    display: block; /* Ensure labels are block level so they take up their own line */
    word-break: break-word; /* Break the word at the end of the line if necessary */
}

/* Adjust space between question and input for better alignment and spacing */
.question, .radio-container, .rating-container, .section-container {
    margin-bottom: 2rem; /* Increase bottom margin for more space before next element */
}

/* Style adjustments for input fields to create underline effect and spacing */
input[type="text"],
input[type="number"],
input[type="email"],
textarea {
    background: transparent;
    border: none;
    border-bottom: 2px solid gray; /* Keep the solid underline */
    border-radius: 0; /* Ensure no border radius */
    padding-top: 8px; /* Add padding at the top for more space */
    padding-bottom: 8px; /* Ensure padding at the bottom for space within the input field */
    margin-top: 0.5rem; /* Additional space above the input field */
    max-width: 100%;
    box-sizing: border-box;
}

input[type="text"]:focus,
input[type="number"]:focus,

.section-title {
    white-space: nowrap; /* Keep titles in a single line */
    overflow: hidden; /* Hide overflow */
    text-overflow: ellipsis; /* Show ellipsis (...) when text is too long */
    max-width: 100%; /* Ensure the max width is not more than its container */
}

.question-container p {
    word-break: break-word; /* This will ensure that long words will break and wrap to the next line */
}

</style>

</head>
<body class="bg-gray-100">
  <div class="container mx-auto px-4 py-8">
    <header class="mb-8 bg-gradient-to-r from-green-600 to-green-600 text-white py-6 px-8 rounded-lg shadow-md flex items-center justify-between">
      <div class="flex items-center">
        <div>
          <h1 class="font-bold text-3xl">Career Restart.</h1>
          <p class="text-sm">Empowering your journey back to the workforce</p>
        </div>
      </div>
      <button class="text-white hover:text-green-200 focus:outline-none transition-colors duration-300">Exit</button>
    </header>

    

    <main>
       <div class="flex items-center justify-between max-w-4xl mx-auto px-8">
        <button id="prevBtn" class="text-gray-500 bg-transparent hover:bg-gray-200 focus:outline-none font-medium py-2 px-4 rounded inline-flex items-center transition-colors duration-300">
          <i class="fas fa-arrow-left mr-2"></i> Previous
        </button>

        <button id="nextBtn" class="text-gray-500 bg-transparent hover:bg-gray-200 focus:outline-none font-medium py-2 px-4 rounded inline-flex items-center transition-colors duration-300">
          Next <i class="fas fa-arrow-right ml-2"></i>
        </button>
       </div>
       
      <div class="flex flex-col items-center justify-center max-w-4xl mx-auto px-3 py-6">
        <div class="grid grid-cols-4 gap-6 mb-0">
          <div id="aboutYouTab" class="bg-gradient-to-r from-green-600 text-white font-semibold text-center py-6 px-4 rounded-lg shadow-md cursor-pointer hover:shadow-lg transition-shadow duration-300">About You</div>
          <div id="coreValuesTab" class="bg-white text-gray-800 font-semibold text-center py-6 px-4 rounded-lg shadow-md cursor-pointer hover:bg-gray-100 transition-colors duration-300">Core Values</div>
          <div id="strengthTab" class="bg-white text-gray-800 font-semibold text-center py-6 px-4 rounded-lg shadow-md cursor-pointer hover:bg-gray-100 transition-colors duration-300">Strengths</div>
          <div id="skillsAssessmentTab" class="bg-white text-gray-800 font-semibold text-center py-6 px-4 rounded-lg shadow-md cursor-pointer hover:bg-gray-100 transition-colors duration-300">Skill Assessment</div>
          <div id="dreamjobTab" class="bg-white text-gray-800 font-semibold text-center py-6 px-4 rounded-lg shadow-md cursor-pointer hover:bg-gray-100 transition-colors duration-300">Dream Job</div>
          <div id="preferencesTab" class="bg-white text-gray-800 font-semibold text-center py-6 px-4 rounded-lg shadow-md cursor-pointer hover:bg-gray-100 transition-colors duration-300">Preferences</div>
          <div id="prioritiesTab" class="bg-white text-gray-800 font-semibold text-center py-6 px-4 rounded-lg shadow-md cursor-pointer hover:bg-gray-100 transition-colors duration-300">Career Priorities</div>
        </div>
      </div>
        

      <div class="mb-6 max-w-2xl mx-auto px-4">
        <div id="progressBar" class="h-6 bg-gray-200 rounded-full overflow-hidden relative">
          <div id="progressCounter" class="absolute inset-0 flex items-center justify-center font-semibold text-gray-700">0%</div>
          <div id="progressBarInner" class="h-full bg-gradient-to-r from-green-500 to-green-500 rounded-full transition-all duration-500"></div>
        </div>
      </div>

      <div class="question-section max-w-2xl mx-auto px-4 mb-10">
        <div id="questionsContainer" class="space-y-8 mb-10">
          <!-- Questions will be dynamically inserted here -->
          <div class="question-container">
            <h2 class="text-3xl font-semibold mb-10">Question Title</h2>
            <p class="text-gray-700 text-lg mb-10">Question description goes here...</p>
            <input type="text" class="w-full bg-transparent border-b border-gray-400 focus:outline-none focus:border-green-500 transition-colors duration-300 text-lg" placeholder="Enter your response">
          </div>
        </div>
        <div class="flex justify-center mt-10">
          <button id="saveBtn" class="text-green-600 bg-transparent hover:bg-blue-100 focus:outline-none font-medium py-2 px-4 rounded inline-flex items-center transition-colors duration-300">
            Next
          </button>
          <button id="displayBtn" class="text-green-600 bg-transparent hover:bg-green-100 focus:outline-none font-medium py-2 px-4 rounded inline-flex items-center transition-colors duration-300">
            Display
          </button>
        </div>
      </div>
    </main>
    <div id="processedResponses" class="processed-responses max-w-2xl mx-auto px-4 mt-8"></div>
    <button id="processBtn" > Process</button>

    <div id="analysisSection" class="mt-10">
      <h2 class="text-xl font-semibold mb-4">Analysis</h2>
      <button id="analyzeBtn" class="bg-green-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors duration-300">Analyze Responses</button>

      <div id="analysisResult" class="mt-4 bg-white p-4 rounded-lg shadow-md" style="min-width: 100%;">
      </div>
    </div>
    <!-- <div id="analysisResult" class="analysis-result max-w-2xl mx-auto px-4 mt-8"></div> -->

    <section class="mt-10">
  <h3 class="text-xl font-semibold mb-4">LinkedIn Profile Generation</h3>
  <button id="generateLinkedInProfile" class="bg-green-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors duration-300">Generate LinkedIn Profile</button>
  <div id="linkedinProfileContent" class="mt-4 bg-white p-4 rounded-lg shadow-md">
    <!-- LinkedIn profile content will be displayed here -->
  </div>
</section>

<section class="mt-10">
  <h3 class="text-xl font-semibold mb-4">Resume Generation</h3>
  <button id="generateResume" class="bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition-colors duration-300">Generate Resume</button>
  <div id="resumeContent" class="mt-4 bg-white p-4 rounded-lg shadow-md">
    <!-- Resume content will be displayed here -->
  </div>
</section>

<script>
    let currentQuestionIndex = 1;
let currentSectionIndex = 0;
let userResponses = {};
let repeatableGroupCounter = {};

    const sections = [
      { // About You Section
        title: "About You",
        questions: [
          { label: "What is your name?", type: "text", id: "name" },
          { label: "What is your mobile number?", type: "number", id: "mobile" },
          { label: "What is your email ID?", type: "email", id: "email" },
          { label: "Your LinkedIn (optional)", type: "text", id: "linkedin" },
          { label: "Your GitHub (optional)", type: "text", id: "github" }
        ]
      },
      { // Core Values Section
        title: "Core Values",
        questions: [
          { label: "What annoys you or gets under your skin at work?", type: "text", id: "annoyance" },
          { label: "What brings you joy in your work?", type: "text", id: "joy" },
          { label: "What could you not live without in a workplace or on a work team?", type: "text", id: "necessity" },
          { label: "Who do you admire and what do you admire about them?", type: "text", id: "admire" }
        ]
      },
      { // Strength Section modified with grouped questions for Exercise 2
        title: "Strength",
    questions: [
      { label: "Strength Exercise 1 - Self Assessment: What do you enjoy the most?", type: "text", id: "enjoyMost" },
      { label: "What am I called on to do most often?", type: "text", id: "calledOn" },
      { label: "What do I do best?", type: "text", id: "doBest" },
      { label: "What advice or expertise do others seek from me?", type: "text", id: "adviceSought" },
      {
        // Strength Exercise 2 treated as a single question group for display purposes
        type: "group", // Custom type to handle grouped inputs
        questions: [
          { label: "Story 1", type: "text", id: "story1" },
          { label: "Feedback for Story 1", type: "text", id: "feedback1" },
          { label: "Story 2", type: "text", id: "story2" },
          { label: "Feedback for Story 2", type: "text", id: "feedback2" }
        ]
      }
      
    ]
  },
  {title: "Skills and Experience",
    // Skills and Experience Exercise Section
    questions: [
      {
        label: "Job: Title or description – where and when?",
        type: "text",
        id: "jobDescription"
      },
      {
        label: "Skills and experience: Direct or transferable",
        type: "text",
        id: "skillsExperience"
      },
      {
        label: "Accomplishments: Measurable; if possible include examples like percentage of goal, dollars in sales, revenue growth, or savings; number of employees hired or trained",
        type: "text",
        id: "accomplishments"
      },
      {
        label: "Benefit to the Employer: how your skills and/or experience benefit the organization and its people",
        type: "text",
        id: "benefitToEmployer"
      }
    ]
  },

  {//dream job
    title: "Dream job",
    questions: [
      {
        label: "If there were no restrictions (for example, education, location, experience, or financial obligations), my dream job would be:",
        type: "text",
        id: "d1"
      },
      {
        label: "Is obtaining this dream job a realistic possibility for me?",
        type: "radio",
        id: "realisticPossibility",
        options: [
          { label: "Yes", value: "yes" },
          { label: "No", value: "no" }
        ]
      },
      {
        label: "If yes, explain how.",
        type: "text",
        id: "d3"
      },
      {
        label: "List at least ten specific attributes of this dream job (for example, content, culture, mission, responsibilities, or perks), as you imagine it, that appeal to you:",
        type: "text",
        id: "d4"
      },
      {
        label: "Working in this dream job would make me feel",
        type: "text",
        id: "d5"
      },
      {
        label: "Working this dream job would fill my need(s) for",
        type: "text",
        id: "d6"
      },
      {
        label: "Working in this dream job would meet my goal(s) of",
        type: "text",
        id: "d7"
      },

    ]
  },
  {
    // Preference Section
    title: "Preferences",
    questions: [
      {
        type: "section",
        title: "Size of Organization",
        questions: [
          { label: "What I think I want", type: "text", id: "sizeWant" },
          { label: "What I know I don't want", type: "text", id: "sizeNotWant" }
        ]
      },
      {
        type: "section",
        title: "Type of Organization",
        questions: [
          { label: "What I think I want", type: "text", id: "typeWant" },
          { label: "What I know I don't want", type: "text", id: "typeNotWant" }
        ]
      },
      {
        type: "section",
        title: "Industry",
        questions: [
          { label: "What I think I want", type: "text", id: "industryWant" },
          { label: "What I know I don't want", type: "text", id: "industryNotWant" }
        ]
      },
      {
        type: "section",
        title: "Department",
        questions: [
          { label: "What I think I want", type: "text", id: "departmentWant" },
          { label: "What I know I don't want", type: "text", id: "departmentNotWant" }
        ]
      },
      {
        type: "section",
        title: "Function",
        questions: [
          { label: "What I think I want", type: "text", id: "functionWant" },
          { label: "What I know I don't want", type: "text", id: "functionNotWant" }
        ]
      }
    ]
  
  },
  {
    // Career Priorities Section
    title: "Career Priorities",
    questions: [
      {
        label: "Rate and Explain: Money",
        type: "rating",
        id: "money",
        explanationLabel: "Why is this important to you?"
      },
      {
        label: "Rate and Explain: Benefits",
        type: "rating",
        id: "benefits",
        explanationLabel: "Why is this important to you?"
      },
      {
        label: "Rate and Explain: Creative control",
        type: "rating",
        id: "creativeControl",
        explanationLabel: "Why is this important to you?"
      },
      {
        label: "Rate and Explain: Flexible work options",
        type: "rating",
        id: "flexibleWork",
        explanationLabel: "Why is this important to you?"
      },
      {
        label: "Rate and Explain: Proximity to home/school/daycare",
        type: "rating",
        id: "proximity",
        explanationLabel: "Why is this important to you?"
      },
      {
        label: "Rate and Explain: Challenge",
        type: "rating",
        id: "challenge",
        explanationLabel: "Why is this important to you?"
      },
      {
        label: "Rate and Explain: Social connections and camaraderie",
        type: "rating",
        id: "socialConnections",
        explanationLabel: "Why is this important to you?"
      },
      {
        label: "Rate and Explain: Measurable success",
        type: "rating",
        id: "measurableSuccess",
        explanationLabel: "Why is this important to you?"
      }
    ]
  }
];
    
function saveResponse(questionId, response) {
    // Save response using the questionId as the key
    userResponses[questionId] = response;

    // Update localStorage with the new state of userResponses
    localStorage.setItem("userResponses", JSON.stringify(userResponses));
}





function saveResponses() {
  const sectionQuestions = sections[currentSectionIndex].questions;
  if (currentQuestionIndex < sectionQuestions.length) {
    currentQuestionIndex++;
    showQuestion(currentQuestionIndex);
  } else if (currentSectionIndex < sections.length - 1) {
    currentSectionIndex++;
    currentQuestionIndex = 1;
    showQuestion(currentQuestionIndex);
  }
  updateSectionTabs();
  updateProgress();
}

document.getElementById('saveBtn').addEventListener('click', saveResponses);


// Add event listener to the Save button
document.getElementById('saveBtn').addEventListener('click', saveResponses);

function updateProgress() {
  // Calculate the overall progress based on the total number of questions.
  const totalQuestions = sections.reduce((total, section) => total + section.questions.length, 0);
  let questionsCompleted = sections.slice(0, currentSectionIndex).reduce((total, section) => total + section.questions.length, 0) + currentQuestionIndex;
  const progressPercentage = (questionsCompleted / totalQuestions) * 100;

  // Update progress bar width
  document.getElementById('progressBarInner').style.width = `${progressPercentage}%`;

  // Update progress counter text
  const progressCounter = document.getElementById('progressCounter');
  progressCounter.textContent = `${Math.round(progressPercentage)}%`;
}

function loadResponses() {
  const savedResponses = localStorage.getItem("userResponses");
  if (savedResponses) {
    userResponses = JSON.parse(savedResponses);
  }
}


    
function updateSectionTabs() {
    const tabIds = ['aboutYouTab', 'coreValuesTab', 'strengthTab', "skillsAssessmentTab", "dreamjobTab", "preferencesTab", "prioritiesTab"];
    tabIds.forEach((id, index) => {
        if (index < currentSectionIndex) {
            document.getElementById(id).className = "bg-green-600 text-white text-center py-2 px-4 rounded";
        } else if (index === currentSectionIndex) {
            document.getElementById(id).className = "bg-mustard text-white text-center py-2 px-4 rounded"; // Updated to mustard color
        } else {
            document.getElementById(id).className = "bg-white text-gray-800 text-center py-2 px-4 rounded shadow";
        }
    });
}
function addMoreRepeatableGroup(groupIndex) {
  const repeatableGroup = sections[currentSectionIndex].questions[groupIndex];
  if (repeatableGroup && repeatableGroup.type === "repeatableGroup") {
    // Increment counter for this group or initialize if not exist
    repeatableGroupCounter[groupIndex] = (repeatableGroupCounter[groupIndex] || 0) + 1;
    const newGroupIndex = `${groupIndex}_${repeatableGroupCounter[groupIndex]}`; // Create a unique index for the new group

    const questionsContainer = document.getElementById('questionsContainer');
    const groupDiv = document.createElement('div');
    groupDiv.setAttribute('id', `repeatableGroup-${newGroupIndex}`);
    groupDiv.className = 'repeatable-group';

    repeatableGroup.questions.forEach((question, index) => {
      const uniqueId = `${repeatableGroup.baseId}-${newGroupIndex}-${index}`;
      const questionHTML = createSubQuestionHTML(question, uniqueId);
      groupDiv.appendChild(questionHTML);
    });

    const addMoreBtn = document.createElement('button');
    addMoreBtn.textContent = 'Add More';
    addMoreBtn.className = 'mt-2 p-2 bg-blue-500 text-white rounded hover:bg-blue-600';
    addMoreBtn.onclick = function() {
      addMoreRepeatableGroup(groupIndex);
    };
    groupDiv.appendChild(addMoreBtn);

    questionsContainer.appendChild(groupDiv);
  }

}

function displayProcessedResponses() {
    const processedDiv = document.getElementById('processedResponses');
    processedDiv.innerHTML = ''; // Clear previous content

    let content = '<h2 class="text-xl font-semibold mb-4">Processed Responses</h2>';

    sections.forEach((section) => {
        let sectionResponsesExist = false;
        let sectionContent = `<h3 class="text-lg font-semibold mt-4 mb-2">${section.title}</h3><ul>`;

        section.questions.forEach((question) => {
            const response = userResponses[question.id];
            if (response) { // Only add if there's a response
                sectionResponsesExist = true;
                sectionContent += `<li><strong>${question.label}:</strong> ${response}</li>`;
            }
        });

        sectionContent += '</ul>';

        // Only add the section content if there are responses in this section
        if (sectionResponsesExist) {
            content += sectionContent;
        }
    });

    processedDiv.innerHTML = content;
}



function createSubQuestionHTML(question, uniqueId) {
  const questionDiv = document.createElement('div');
  questionDiv.className = 'question';

  const label = document.createElement('label');
  label.setAttribute('for', uniqueId);
  label.className = 'block text-gray-700 text-sm font-bold mb-2';
  label.textContent = question.label;

  const input = document.createElement('input');
input.type = 'text';

  // In your createSubQuestionHTML function and similar
input.id = `${sectionIndex}-${questionIndex}-${question.id}`; // Adjust if necessary to match your structure

  input.placeholder = question.label;
  input.className = 'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline';

  input.addEventListener('change', function() {
    saveResponse(uniqueId, input.value); // Adjust this if necessary to fit your response handling
  });

  questionDiv.appendChild(label);
  questionDiv.appendChild(input);

  return questionDiv;
}

function updateRatingBar(ratingBar, selectedRating) {
  const ratingItems = ratingBar.querySelectorAll('.rating-item');
  ratingItems.forEach((item, index) => {
    if (index < selectedRating) {
      item.classList.add('selected');
    } else {
      item.classList.remove('selected');
    }
  });
}


    
function createQuestionHTML(question, parentIndex = "") {
  if (question.type === "group") {
    const groupDiv = document.createElement('div');
    groupDiv.className = 'question-group';

    question.questions.forEach(subQuestion => {
      const subQuestionHTML = createQuestionHTML(subQuestion, `${parentIndex}-${subQuestion.id}`);
      groupDiv.appendChild(subQuestionHTML);
    });

    return groupDiv;
  } else if (question.type === "repeatableGroup") {
    const groupContainer = document.createElement('div');
    groupContainer.className = 'question-group';
    const groupId = `repeatableGroup-${parentIndex}-${question.baseId}`;
    groupContainer.setAttribute('id', groupId);

    question.questions.forEach((subQuestion, index) => {
      const uniqueId = `${question.baseId}-${parentIndex}-${index}`;
      const questionDiv = createSubQuestionHTML(subQuestion, uniqueId);
      groupContainer.appendChild(questionDiv);
    });

    const addMoreBtn = document.createElement('button');
    addMoreBtn.textContent = 'Add More';
    addMoreBtn.className = 'mt-2 p-2 bg-blue-500 text-white rounded hover:bg-blue-600';
    addMoreBtn.onclick = function() {
      addMoreRepeatableGroup(parentIndex.split('-')[1]); // Extract group index from parentIndex
    };
    groupContainer.appendChild(addMoreBtn);

    return groupContainer;

  }
  else if (question.type === "radio") {
  const radioContainer = document.createElement('div');
  radioContainer.className = 'radio-container mb-4 p-4';

  // Create and append the question label
  const questionLabel = document.createElement('h3');
  questionLabel.textContent = question.label;
  questionLabel.className = 'text-lg font-semibold mb-2';
  radioContainer.appendChild(questionLabel);

  question.options.forEach(option => {
    const optionContainer = document.createElement('div');
    optionContainer.className = 'flex items-center mb-2';

    const input = document.createElement('input');
    input.type = 'radio';
    input.id = `${question.id}-${option.value}`;
    input.name = question.id;
    input.value = option.value;
    input.className = 'form-radio h-5 w-5 text-blue-600';

    // Add an event listener to save the response when a radio button is selected
    input.addEventListener('change', function() {
      saveResponse(question.id, this.value);
    });

    const label = document.createElement('label');
    label.setAttribute('for', input.id);
    label.textContent = option.label;
    label.className = 'ml-2 text-gray-700';

    optionContainer.appendChild(input);
    optionContainer.appendChild(label);
    radioContainer.appendChild(optionContainer);
  });

  return radioContainer;
}


  else if (question.type === "section") {
    const sectionContainer = document.createElement('div');
    sectionContainer.className = 'section-container';

    const sectionTitle = document.createElement('h2');
    sectionTitle.textContent = question.title;
    sectionTitle.className = 'section-title';
    sectionContainer.appendChild(sectionTitle);

    question.questions.forEach(subQuestion => {
      const subQuestionHTML = createQuestionHTML(subQuestion, `${parentIndex}-${subQuestion.id}`);
      sectionContainer.appendChild(subQuestionHTML);
    });

    return sectionContainer;
  }

  else if (question.type === "rating") {
  const ratingContainer = document.createElement('div');
  ratingContainer.className = 'rating-container flex flex-col items-center my-4';

  const label = document.createElement('label');
  label.textContent = question.label;
  label.className = 'rating-label mb-2';
  ratingContainer.appendChild(label);

  const ratingValueDisplay = document.createElement('div');
  ratingValueDisplay.className = 'rating-value text-lg mb-2';
  ratingValueDisplay.textContent = 'Rating: 5'; // Default or previously saved rating

  const input = document.createElement('input');
  input.type = 'range';
  input.id = question.id;
  input.name = question.id;
  input.min = "1";
  input.max = "8"; // As per your rating scale
  input.className = 'rating-range';
  input.addEventListener('input', function() {
    ratingValueDisplay.textContent = `Rating: ${input.value}`; // Update display as the slider moves
    saveResponse(question.id, input.value); // Save the rating value
  });

  const explanationLabel = document.createElement('label');
  explanationLabel.textContent = question.explanationLabel;
  explanationLabel.className = 'explanation-label mt-4';
  ratingContainer.appendChild(explanationLabel);

  const explanationInput = document.createElement('textarea');
  explanationInput.id = `${question.id}-explanation`;
  explanationInput.placeholder = question.explanationLabel;
  explanationInput.className = 'explanation-input mt-2 w-full p-2 border rounded';
  explanationInput.addEventListener('input', () => {
    saveResponse(`${question.id}-explanation`, explanationInput.value); // Save the explanation
  });

  ratingContainer.appendChild(ratingValueDisplay);
  ratingContainer.appendChild(input);
  ratingContainer.appendChild(explanationInput);

  return ratingContainer;
}

  else {
    // Standard question handling
    const questionDiv = document.createElement('div');
    questionDiv.className = 'question';

    const label = document.createElement('label');
    label.setAttribute('for', question.id);
    label.className = 'block text-gray-700 text-sm font-bold mb-2';
    label.textContent = question.label;

    const input = document.createElement('input');
    input.type = question.type;
    input.id = question.id;
    input.placeholder = question.label;
    input.className = 'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline';

    input.addEventListener('change', function() {
      saveResponse(question.id, input.value);
    });

    questionDiv.appendChild(label);
    questionDiv.appendChild(input);

    return questionDiv;
  }
}
function attachChangeEventToInputs() {
    document.querySelectorAll('input[type="text"], input[type="number"], input[type="email"], input[type="radio"], textarea').forEach(input => {
        input.addEventListener('change', function() {
            const questionId = this.id;
            const response = this.type === 'radio' ? this.value : this.value;
            saveResponse(questionId, response === 'on' ? 'Yes' : response);
            input.removeEventListener('change', handleInputChange); // Prevent multiple listeners
            input.addEventListener('change', handleInputChange);

        });
    });


    document.querySelectorAll('input[type="text"], input[type="number"], input[type="email"], textarea').forEach(input => {
        input.addEventListener('change', function() {
            const questionId = this.id;
            const response = this.value;
            saveResponse(questionId, response);
        });
    });
}

// function displayResponses() {
//     const questionsContainer = document.getElementById('questionsContainer');
//     questionsContainer.innerHTML = ''; // Clear previous content

//     sections.forEach((section, sectionIndex) => {
//         section.questions.forEach((question, questionIndex) => {
//             const questionId = question.id; // Assuming question IDs are unique across sections

//             const response = userResponses[questionId] || 'Not provided';

//             const questionDiv = document.createElement('div');
//             questionDiv.className = 'mb-4 p-4 bg-gray-100 rounded';

//             const questionLabel = document.createElement('h3');
//             questionLabel.className = 'text-lg font-semibold mb-2';
//             questionLabel.textContent = question.label;
//             questionDiv.appendChild(questionLabel);

//             const responseText = document.createElement('p');
//             responseText.textContent = `Answer: ${response}`;
//             questionDiv.appendChild(responseText);

//             questionsContainer.appendChild(questionDiv);
//         });
//     });
// }

function getQuestionTextById(questionId) {
    let questionText = "Question not found"; // Default text in case the question ID does not match

    const isExplanation = questionId.endsWith("_explanation");
    const baseId = isExplanation ? questionId.replace("_explanation", "") : questionId;



    // A helper function to search within a list of questions
    function searchQuestions(questions, parentTitle = "") {
        return questions.some(question => {
            // Check if the current question is a section with nested questions
            if (question.type === "section") {
                // Search within the nested questions, passing down the title
                const found = searchQuestions(question.questions, question.title);
                if (found) return true; // If found in nested, no need to search further
            } else if (question.id === questionId) {
                // Match found, prepend parent title if exists
                questionText = parentTitle ? `${parentTitle} : ${question.label}` : question.label;
                return true; // Match found, break the search
            }
            return false; // Continue searching
        });
    }

    // Start the search from the top-level sections
    sections.some(section => {
        return searchQuestions(section.questions);
    });

    return questionText;
}


function displayResponses() {
    const questionsContainer = document.getElementById('questionsContainer');
    questionsContainer.innerHTML = ''; // Clear previous content

    Object.keys(userResponses).forEach((questionId) => {
        const response = userResponses[questionId];
        const questionDiv = document.createElement('div');
        questionDiv.className = 'mb-4 p-4 bg-gray-100 rounded';

        const questionText = getQuestionTextById(questionId); // Fetch the full question text

        const questionLabel = document.createElement('h3');
        questionLabel.className = 'text-lg font-semibold mb-2';
        questionLabel.textContent = questionText; // Display the full question text
        questionDiv.appendChild(questionLabel);

        const responseText = document.createElement('p');
        responseText.textContent = `Answer: ${response}`;
        questionDiv.appendChild(responseText);

        questionsContainer.appendChild(questionDiv);
    });
}



document.getElementById('saveBtn').addEventListener('click', saveResponses);
document.getElementById('displayBtn').addEventListener('click', displayResponses);

document.getElementById('processBtn').addEventListener('click', async function() {
    const userResponses = JSON.parse(localStorage.getItem("userResponses") || "{}");
    // Send this data to the server
    await fetch('/save_responses', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(userResponses),
    }).then(response => response.json())
    .then(data => {
        // Check if the responses were saved successfully
        if(data.message === "Responses saved successfully") {
            // Redirect if successful
            window.location.href = '/show_responses';
        } else {
            console.error('Failed to save responses');
        }
    })
    .catch(error => console.error('Error:', error));
});



document.addEventListener('DOMContentLoaded', function() {
    loadResponses(); // Load saved responses if any
    attachChangeEventToInputs(); // Attach change events to inputs
    showQuestion(currentQuestionIndex); // Show the first question
});



document.getElementById("generateLinkedInProfile").addEventListener("click", function() {
    fetch('/generate-linkedin-profile', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        // Display the generated LinkedIn content
        document.getElementById("linkedinProfileContent").innerHTML = `<pre>${data.linkedinContent}</pre>`;
    })
    .catch(error => console.error('Error:', error));
});


function prepareDataForAnalysis() {
    const data = sections.reduce((acc, section) => {
        // Ensure each section is accounted for
        acc[section.title] = acc[section.title] || {};
        section.questions.forEach(question => {
            const response = userResponses[question.id];
            if (response) {
                // Store responses in a manner that the backend expects
                acc[section.title][question.label] = response;
            }
        });
        return acc;
    }, {});

    return data;
}


function performAnalysis() {
    const data = prepareDataForAnalysis();
    // Assume you have an endpoint '/analyze' set up on your server
    fetch('/analyze', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
    })
    .then(response => response.json())
    .then(data => {
        console.log('Success:', data);
        displayAnalysisResults(data.analysis);
    })
    .catch((error) => {
        console.error('Error:', error);
    });
}

document.getElementById("generateResume").addEventListener("click", function() {
    fetch('/generate-resume', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        // Display the generated resume content
        document.getElementById("resumeContent").innerHTML = `<pre>${data.resumeContent}</pre>`;
    })
    .catch(error => console.error('Error:', error));
});


function displayAnalysisResults(analysis) {
    const analysisDiv = document.getElementById('analysisSection');
    analysisDiv.innerHTML = `<pre>${analysis}</pre>`; // Display the analysis result
}

function displayFormattedAnalysis(analysisText) {
    // Split the analysis text into paragraphs
    const paragraphs = analysisText.split('\n\n');

    let formattedAnalysis = '';

    paragraphs.forEach(paragraph => {
        // Check for list items within paragraphs
        const listItems = paragraph.match(/- (.*)/g);

        if (listItems) {
            // If list items exist, format them
            formattedAnalysis += '<ul>';
            listItems.forEach(item => {
                // Bold text wrapped in **
                const formattedItem = item.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                formattedAnalysis += `<li>${formattedItem}</li>`;
            });
            formattedAnalysis += '</ul>';
        } else {
            // Bold text wrapped in **
            const formattedParagraph = paragraph.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            formattedAnalysis += `<p>${formattedParagraph}</p>`;
        }
    });

    // Set the formatted analysis to the innerHTML of the analysis result section
    document.getElementById('analysisResult').innerHTML = formattedAnalysis;
}


// Replace the direct assignment in analyzeResponses with a call to this new function
async function analyzeResponses() {
    const dataForAnalysis = prepareDataForAnalysis();
    console.log("Data for analysis:", dataForAnalysis);

    // Assuming your backend is ready to receive and process this data
    const response = await fetch('/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(dataForAnalysis)
    });

    const analysisResult = await response.json();

    // Use the new function to display the analysis result
    displayFormattedAnalysis(analysisResult.analysis);
}

function prepareDataForAnalysis() {
    const data = {
        about_you: {},
        career_priorities: {},
        core_values: {},
        strengths: {},
        dream_job: {},
        preferences: {},
        skills_experience: {},
    };

    // Populate data object with user responses
    sections.forEach(section => {
        section.questions.forEach(question => {
            let key = section.title.toLowerCase().replace(/\s+/g, '_');
            if (!data[key]) {
                data[key] = {};
            }
            const response = userResponses[question.id];
            if (response) {
                data[key][question.label] = response;
            }
        });
    });

    return data;
}

function handleInputChange() {
    const questionId = this.id;
    const response = this.type === 'radio' ? this.checked ? this.value : '' : this.value;
    if (response) { // Check to ensure empty strings or unchecked radios don't overwrite existing responses
        saveResponse(questionId, response);
    }
}


function displayAnalysisResults(analysis) {
    const analysisDiv = document.getElementById('analysisSection');
    analysisDiv.innerHTML = `<pre>${analysis}</pre>`; // Display the analysis result
}

document.getElementById('analyzeBtn').addEventListener('click', analyzeResponses);


function showQuestion(index) {
    const questionsContainer = document.getElementById('questionsContainer');
    questionsContainer.innerHTML = ''; // Clear previous content

    const section = sections[currentSectionIndex];
    const questionHTML = createQuestionHTML(section.questions[index - 1]);

    // Add animation class
    questionHTML.classList.add('question-container');

    questionsContainer.appendChild(questionHTML);

    updateProgress(); // Ensure progress is updated

    attachChangeEventToInputs(); 
}


document.getElementById('prevBtn').addEventListener('click', function() {
  // Adjusted to account for grouped questions as a single index
  if (currentQuestionIndex > 1) {
    currentQuestionIndex--;
    showQuestion(currentQuestionIndex);
  } else if (currentSectionIndex > 0) {
    // Navigate to previous section if applicable
    currentSectionIndex--;
    currentQuestionIndex = sections[currentSectionIndex].questions.length;
    showQuestion(currentQuestionIndex);
  }
  updateSectionTabs();
});

document.getElementById('nextBtn').addEventListener('click', function() {
  // Adjusted to account for grouped questions as a single index
  const sectionQuestions = sections[currentSectionIndex].questions;
  if (currentQuestionIndex < sectionQuestions.length) {
    currentQuestionIndex++;
    showQuestion(currentQuestionIndex);
  } else if (currentSectionIndex < sections.length - 1) {
    // Move to next section if available
    currentSectionIndex++;
    currentQuestionIndex = 1;
    showQuestion(currentQuestionIndex);
  }
  updateSectionTabs();
});

    
    // Initial display and setup
updateSectionTabs();
updateProgress();

console.log("Saving response for", questionId, response);
console.log("Displaying responses", userResponses);


    </script>
</body>
</html>